---
title: "Mechanical loading prediction through accelerometry data during walking and running"
output:
  bookdown::pdf_document2:
    toc: false
    includes:
      in_header: "preamble.tex"
    latex_engine: lualatex
  word_document:
    reference_docx: style_reference.docx
always_allow_html: true
bibliography: bibliography.bib
csl: nlm.csl
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, results = "hide", message = FALSE, warning = FALSE
)
```

```{r source}
library(here)
library(broman)
library(kableExtra)
library(english)
source(here("code", "02_explore.R"))
```

```{r GRF_accuracy}
load(here("output", "prediction_models.rda"))
res_GRF_accuracy <- purrr::map(
  accuracy_res_GRF_models,
  ~ dplyr::mutate(.x, MAPE = as.numeric(MAPE))
) %>%
  purrr::map_dfr(rbind) %>%
  dplyr::mutate(
    placement = c("ankle", "lower back", "hip"),
    vector = "resultant"
  )
ver_GRF_accuracy <- purrr::map(
  accuracy_ver_GRF_models,
  ~ dplyr::mutate(.x, MAPE = as.numeric(MAPE))
) %>%
  purrr::map_dfr(rbind) %>%
  dplyr::mutate(
    placement = c("ankle", "lower back", "hip"),
    vector = "vertical"
  )
GRF_accuracy <- rbind(res_GRF_accuracy, ver_GRF_accuracy)
hip_GRF_accuracy <- GRF_accuracy %>%
  filter(placement == "hip" & vector == "resultant")
```

```{r LR_accuracy}
load(here("output", "prediction_models.rda"))
res_LR_accuracy <- purrr::map(
  accuracy_res_LR_models,
  ~ dplyr::mutate(.x, MAPE = as.numeric(MAPE))
) %>%
  purrr::map_dfr(rbind) %>%
  dplyr::mutate(
    placement = c("ankle", "lower back", "hip"),
    vector = "resultant"
  )
ver_LR_accuracy <- purrr::map(
  accuracy_ver_LR_models,
  ~ dplyr::mutate(.x, MAPE = as.numeric(MAPE))
) %>%
  purrr::map_dfr(rbind) %>%
  dplyr::mutate(
    placement = c("ankle", "lower back", "hip"),
    vector = "vertical"
  )
LR_accuracy <- rbind(res_LR_accuracy, ver_LR_accuracy)
hip_LR_accuracy <- LR_accuracy %>%
  filter(placement == "hip" & vector == "resultant")
```

```{r ba_regression}
source(here("code", "04_sub_analyses.R"))
ba_regression_ankle_R2 <- c(
  ba_regression_res_GRF$ankle["adj.r.squared"],
  ba_regression_ver_GRF$ankle["adj.r.squared"],
  ba_regression_res_LR$ankle["adj.r.squared"],
  ba_regression_ver_LR$ankle["adj.r.squared"]
) %>%
  as_vector()
```

```{r ba_agreement}
load(here("output", "loocv_data.rda"))
percent_inside_loa <- function(data) {
  lower <- lvmisc::loa(
    data[[".actual"]], data[[".predicted"]], na.rm = TRUE
  )$lower
  upper <- lvmisc::loa(
    data[[".actual"]], data[[".predicted"]], na.rm = TRUE
  )$upper
  diff <- dplyr::transmute(
    data, diff = .data[[".actual"]] - .data[[".predicted"]]
  )
  diff <- dplyr::mutate(
    diff,
    inside = as.factor(ifelse(diff > lower & diff < upper, "yes", "no"))
  )
  round(prop.table(table(diff$inside))[[2]] * 100, 0)
}

ba_agreement <- min(
  map_dbl(cv_res_GRF_models, percent_inside_loa) %>% min(),
  map_dbl(cv_ver_GRF_models, percent_inside_loa) %>% min(),
  map_dbl(cv_res_LR_models, percent_inside_loa) %>% min(),
  map_dbl(cv_ver_LR_models, percent_inside_loa) %>% min()
)
```

```{r accuracy_no_cv}
accuracy_no_cv <- map_dfr(res_GRF_models, accuracy) %>%
  select(MAPE) %>%
  mutate(MAPE = as.numeric(MAPE))
accuracy_no_cv <- myround(max(accuracy_no_cv) * 100, 1)
```



<center>
Lucas Veras$^{1,2}$, Florêncio Diniz-Sousa$^{1,2}$, Giorjines Boppre$^{1,2}$, Edgar Moutinho-Ribeiro$^{1,2}$, Ana Resende-Coelho$^{1,2}$, Vítor Devezas$^3$, Hugo Santos-Sousa$^3$, John Preto$^3$, João Paulo Vilas-Boas$^{4,5}$, Leandro Machado$^{4,5}$, José Oliveira$^{1,2}$, Hélder Fonseca$^{1,2}$
</center>

\bigskip

1 - Research Center in Physical Activity, Health and Leisure (CIAFEL), Faculty of Sport, University of Porto, Porto, Portugal

2 - Laboratory for Integrative and Translational Research in Population Health (ITR), University of Porto, Porto, Portugal

3 - General Surgery Department, São João Medical Center, Porto, Portugal

4 - Center of Research, Education, Innovation and Intervention in Sport (CIFI2D), Faculty of Sport, University of Porto, Porto, Portugal

5 - Biomechanics Laboratory (LABIOMEP-UP), University of Porto, Porto, Portugal

\leftskip=0.5in \rightskip=0.5in

\bigskip

# Abstract {.unnumbered}

**Purpose:** To develop accelerometry-based equations to predict peak ground reaction forces (pGRF) and peak loading rate (pLR) during walking and running. **Methods:** `r max(sample_size$pGRF_N)` subjects (`r unname(sample_size_sex["F"])` females; `r sample_descriptives$body_mass_mean`±`r sample_descriptives$body_mass_sd`kg) walked and ran at different speeds (2–14km·h^-1^) on a force plate–equipped treadmill while wearing accelerometers at their ankle, lower back and hip. Regression equations were developed to predict pGRF and pLR from accelerometry data. Leave-one-out cross-validation was used to calculate prediction accuracy and Bland–Altman plots. Our pGRF prediction equation was compared with a reference equation previously published. **Results:** Body mass and peak acceleration were included for pGRF prediction and body mass and peak acceleration rate for pLR prediction. All pGRF equation coefficients of determination were above `r myround(min(GRF_accuracy$R2_cond), 2)`, and a good agreement between actual and predicted pGRF was observed, with a mean absolute percent error (MAPE) below `r myround(max(GRF_accuracy$MAPE) * 100, 1)`\%. Accuracy indices from our equations were better than previously developed equations. All pLR prediction equations presented a lower accuracy compared to those developed to predict pGRF. **Conclusion:** Walking and running pGRF can be predicted with high accuracy by accelerometry-based equations, representing an easy way to determine mechanical loading in free-living conditions. The pLR prediction equations yielded an unsatisfactory accuracy. **Key Words:** activity monitor; force plates; locomotion; raw acceleration; mechanical loading.

\leftskip=0in \rightskip=0in

# Introduction {.unnumbered}

Physical activity-related mechanical loading plays a key role in bone health, by promoting favorable adaptations on bone mass, geometry and microarchitecture [@Turner2003; @Fonseca2014]. However, not all forms of mechanical stimulation are equally osteogenic, and the manipulation of variables such as loading magnitude, rate, frequency and volume can produce different bone responses [@Turner1998; @Turner2003]. Therefore, the accurate assessment of mechanical loading is of paramount importance to better understand the bone response to physical stimulus. Nonetheless, a limitation in this context is that mechanical loading evaluation is usually performed only by instruments restrained to laboratory settings.

\medskip

Force plates (FP) are the golden standard instrument for mechanical loading measurement [@Medved2000]. However, their cost, need of expertise to collect and analyze data, of a dedicated indoor space and ongoing calibration and maintenance hinders its application in free-living conditions. Accelerometers, due to their portability, low-cost and reliability, are widely used to objectively measure physical activity related to cardiometabolic outcomes [@Troiano2014; @Migueles2017], and, more recently, have been proposed as adequate devices to predict gravitational loading variables [@Neugebauer2012; @Fortune2014; @Neugebauer2014; @Neugebauer2018; @Veras2020]. Given the need to assess mechanical loading in out-of-laboratory environments to control and monitor exercise prescription for bone health, accurate mechanical loading prediction models need to be developed and validated for the most common physical activities prescribed to induce bone adaptations, such as walking, running, and jumping. These models, apart from being accurate, need to be transparent in their data processing methods, allowing reproducibility of the results, and ideally offer a tool to facilitate data processing and analysis for those who are not familiar with the employed techniques, such as what is already offered for analyzing cardiometabolic variables [@Migueles2019], and therefore increase their applicability.

\medskip

The ground reaction force (GRF) is arguably the most studied mechanical loading variable, and its relationship with bone adaptations to exercise is well established [@Turner2003; @Rantalainen2008; @Rantalainen2009]. Due to its importance, some studies have already attempted to develop peak GRF (pGRF) prediction equations based on accelerometry data in different populations, such as children [@Neugebauer2012], adults [@Fortune2014; @Neugebauer2014], patients with obesity [@Veras2020] and military personal [@Neugebauer2018], but with the majority of these studies including only activities eliciting a low loading magnitude. Besides loading magnitude, loading rate (LR) is another variable related to bone health [@Rowlands2014] that could potentially be predicted by accelerometer data, but with apparently lower prediction accuracy compared with pGRF [@Fortune2014; @Veras2020]. Furthermore, to the best of our knowledge, peak LR (pLR) prediction through accelerometer data has only been tested during walking.

\medskip

Therefore, given the necessity of an accurate and reliable method to assess mechanical loading in free-living conditions to better monitor and prescribe exercise to achieve positive bone health outcomes, this study aimed to develop pGRF and pLR prediction models based on accelerometer data during walking and running.

# Methods {.unnumbered}

## Participants {.unnumbered}

A convenience sample of `r max(sample_size$pGRF_N)` adults (`r unname(sample_size_sex["F"])` males; `r sample_descriptives$age_mean`±`r sample_descriptives$age_sd` years; `r sample_descriptives$height_mean`±`r sample_descriptives$height_sd` cm; `r sample_descriptives$body_mass_mean`±`r sample_descriptives$body_mass_sd` kg; `r sample_descriptives$BMI_mean`±`r sample_descriptives$BMI_sd` kg·m^-2^, X̄±SD) with no self-reported neurological or musculoskeletal limitations was recruited. Height and body mass were assessed following standard procedures with a stadiometer (model 213; Seca, Hamburg, Germany) and a digital scale (model 899; Seca, Hamburg, Germany), respectively. All participants were informed about the experiments purpose and protocol before giving written informed consent. The study protocol was approved by the local Ethics Committee (CES 192-14).

## Data collection protocol {.unnumbered}

Data collection took place at Porto Biomechanics Laboratory (LABIOMEP-UP) on an instrumented front-back split-belt treadmill with built-in FP (AMTI Corporation, Watertown, USA). Before starting the data collection, participants were given time to familiarize with the treadmill. The protocol consisted of walking and running, from 2 to 14 km·h^-1^ with 1 km·h^-1^ increment and 0º slope. Walking and running speeds ranged from 2 to 6 km·h^-1^ and from 7 to 14 km·h^-1^, respectively. Each walking speed lasted 1 minute and each running speed 30 seconds. To ensure single foot contact on each FP during the trial, feedback regarding the location on the treadmill was provided by a researcher. Participants wore their own sports shoes throughout the trials.

\medskip

During the protocol, participants wore three activity monitors, one at their right hip (along the anterior axillary line, at the level of the iliac crest), another at their lower back (at the midpoint between the two posterior superior iliac spines) and the last at their right ankle (immediately superior to the lateral malleolus). Activity monitors at waist level were secured on the same elastic belt with a clip and the activity monitor placed on the ankle was secured by an elastic belt fixed with adhesive tape. In all placements, the accelerometer vertical axis was aligned with the standing body longitudinal axis.

\medskip

Motion sensors used were the GT9X Link model (±16*g* range; ActiGraph, Pensacola, USA) that incorporates primary and secondary triaxial accelerometers. As a manufacturer proprietary filter is applied on the primary, but not on the secondary accelerometer raw data, only data from the latter was used in this study, reducing filtering bias and enhancing the data processing replicability.

\medskip

Data from FP were collected at 1000 Hz and from accelerometers at 100 Hz, which is the GT9X Link maximum sampling frequency, and operated through the manufacturer supplied software (for the FP: Netforce, Version 3.5.1; AMTI Corporation, Watertown, USA; for the accelerometers: ActiLife version 6.13.3; Actigraph, Pensacola, USA). Raw GRF (expressed in N) and acceleration (ACC; expressed in gravitational ACC units; 1*g* = 9.807 m·s^-2^) from the x, y and z vectors were exported to plain text files.

## Data processing {.unnumbered}

FP and accelerometer data were processed using MATLAB (Version 2019a, Mathworks, Natick, USA), as described elsewhere [@Veras2020]. Briefly, both GRF and acceleration signals were filtered using a Butterworth fourth-order low-pass filter, with 20 Hz cut-off frequency, and their resultant vector calculated ($r_i = \sqrt{x_i^2 + y_i^2 + z_i^2}$). After that, peak ACC (pACC) values were defined as minimum height of twice the positive ACC average, during any given speed, and separated by 0.4 seconds minimum. GRF and ACC signals were adjusted through the time set by the systems clock, with manual correction based on visual inspection for possible errors, and then synchronized by the maximum cross-correlation coefficient. Peak GRF (pGRF) was determined as the highest value between 0.4 seconds before and after each pACC. The rates of change were computed through a centered derivative from the beginning of the foot contact to the peak (Equation 1). The peak loading rate (pLR) and peak acceleration rate (pAR) were defined as the maximum value in the array (Equation 2).

\[f_i^{'} = \frac{f_{i + 1} - f_{i - 1}}{t_{i + 1} - t_{i - 1}}\]

\[f_{i_{max}}^{'} = max(f_i^{'})\]

Regions of interest for data analysis were manually selected where locomotion patterns were constant, representing 20-45 seconds periods, on average. Then, pGRF, pACC, pLR and pAR means of the resultant and its vertical component for each participant at each speed and for each accelerometer placement were extracted and used in all remaining analyses. In walking and running trials, `r round(n_peaks_desc[which(n_peaks_desc$locomotion_type == "walking"), "n_peaks_mean"], 0)`±`r round(n_peaks_desc[which(n_peaks_desc$locomotion_type == "walking"), "n_peaks_sd"], 0)` and `r round(n_peaks_desc[which(n_peaks_desc$locomotion_type == "running"), "n_peaks_mean"], 0)`±`r round(n_peaks_desc[which(n_peaks_desc$locomotion_type == "running"), "n_peaks_sd"], 0)` peaks were used to calculate these means, respectively.

## Statistical analyses {.unnumbered}

Statistical analyses were conducted using R statistical software (version `r paste(R.Version()$major, R.Version()$minor, sep = ".")`, R Foundation for Statistical Computing, Vienna, Austria). All statistical analyses were registered in an open platform, where R code utilized can be assessed (https://bit.ly/3A6P3Tx). The statistically significant value was set as $\alpha$ = 0.05.

\medskip

Regression equations to predict pGFR and pLR in each vector (resultant and vertical) for each accelerometer placement (ankle, lower back and hip) were developed by linear mixed models. Body mass (kg) was tested as a predictor in all models. Additionally, pACC and pAR were tested as predictors in the pGRF and pLR models, respectively. All predictors were tested as fixed effects and were shown to be significant. Subject and speed were tested as random effects, and the inclusion of both has showed to improve the models. Final models were chosen according to -2 log-likelihood statistics [@Field2012]. Traditional coefficient of determination (R^2^) was represented by conditional R^2^, which estimates the variance explained by the whole model [@Nakagawa2013].

\medskip

Models were validated using the leave-one-out cross-validation approach [@Staudenmayer2012]. For this, each participant’s data were separated into a testing dataset (one participant at a time) with the remaining data in the training dataset. New linear mixed models with the same outcomes and predictors as determined for the entire sample were developed using the training dataset and then used to predict the outcome for the participant in the testing dataset. This process was repeated for all participants (`r max(sample_size$pGRF_N)` times). Data from the testing dataset was used in the remaining statistical analysis.

\medskip

To assess the models prediction accuracy, mean absolute error (MAE), mean absolute percent error (MAPE) and root mean square error (RMSE) were calculated. Although there is no standard threshold defining an acceptable error for mechanical loading prediction, based on previous studies we considered a MAPE <8\% to be an accurate prediction [@Fortune2014; @Neugebauer2014; @Ancillao2018]. Also, methods agreement was evaluated with Bland-Altman plots by plotting the difference between the actual (FP measured) and predicted values against their mean. Bias was computed as the mean of these differences and the limits of agreement were obtained using ±1.96 standard deviation of the bias [@Bland1986]. To test whether there was a consistent over or underestimation of the actual values, one-sample *t*-tests were performed to assess if the difference between actual and predicted values were different than zero. Linear regressions were applied to identify if the magnitude of the mean between actual and predicted values influenced the magnitude of their difference. This was done to ascertain if the prediction accuracy was constant throughout the assayed magnitude range, which is known as proportional bias [@Giavarina2015]. These analyses were conducted separately for data from each accelerometer placement and outcome.

\medskip

Finally, our pGRF prediction equation was compared with a previously published reference equation [@Neugebauer2014], that was developed using similar methods. This comparison was performed in three ways, using: i) the whole sample; ii) a subsample of walking trials; iii) a subsample of running trials. To assess the prediction accuracy, MAE, MAPE and RMSE were calculated using pGRF values predicted from both equations. No pLR prediction equation developed for both walking and running was found to be compared with ours.

\medskip

# Results {.unnumbered}

The sample presented a broad range of body masses (`r myround(min(mechanical_load_data$body_mass))`-`r myround(max(mechanical_load_data$body_mass))`kg; `r myround(min(mechanical_load_data$BMI))`-`r myround(max(mechanical_load_data$BMI))`kg·m^-2^), from normal weight to severe obesity. It was expected that participants with higher body mass index (BMI) , due to their probable lower motor ability and physical capacity, would be able to perform the trials only at the lowest speeds. This was precisely what happened and, as can be observed in Figure 1, the number of data points corresponding to subjects with BMI > 30 kg·m^-2^ greatly decreases in speeds above 6 km·h^-1^.

\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{fig1.png}
		\caption{Distribution of participant’s body mass index per speed. Dots represent individual participants.}
	\end{measuredfigure}
\end{figure}

\medskip

As the main variables collected in this experiment are the peak magnitudes and rates of the GRF and ACC signals, there was a need to first establish their relationship. During locomotion, pACC increases linearly as pGRF increases. Such relation can be observed in Figure 2, Panel A, for hip-worn accelerometers and the resultant vector, and in Supplemental Figure S1 for all placements and the resultant vector and its vertical component. Moreover, for the same pACC values, the registered pGRF tended to be higher in subjects with higher BMI. This demonstrates that accelerometer data can adequately discriminate between different BMI categories. However, data from the pAR x pLR relationship show a greater dispersion, especially at higher values, and the different BMI categories cannot be discriminated so well, as can be observed in Figure 2, Panel B, and Supplemental Figure S2.

\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{fig2.png}
		\caption{Relationship between variables collected by force plates and accelerometers worn at hip, for the resultant vector. Linear trends for each body mass index category are also depicted. Panel A shows peak magnitudes (pGRF and pACC) while Panel B shows peak rates (pLR and pAR). Abbreviations: pACC, peak acceleration; pAR, peak acceleration rate; pGRF, peak ground reaction force; pLR, peak loading rate.}
	\end{measuredfigure}
\end{figure}

\medskip

Regression equations were developed to predict the mechanical loading variables based on accelerometry data. In the pGRF prediction equations, body mass and pACC were significant predictors and, therefore, included in the models. Table 1 shows the regression coefficients, R^2^ and accuracy indices from models derived from accelerometers placed at ankle, lower back and hip, and from the resultant vector and its vertical component. In the pGRF prediction models, the lowest R^2^ value found was `r min(GRF_accuracy$R2_cond)`, which shows that the predictor variables can explain the variability in the outcome variable to a great extent. Also, MAE ranged between `r myround(min(GRF_accuracy$MAE), 1)` N and `r myround(max(GRF_accuracy$MAE), 1)` N, and the MAPE from `r myround(min(GRF_accuracy$MAPE) * 100, 1)`\% to `r myround(max(GRF_accuracy$MAPE) * 100, 1)`\%, which is a smaller error than in previously published equations [@Neugebauer2014; @Fortune2014], and similar to the error from equations previously published by our group for walking only [@Veras2020]. RMSE was also computed and shown to range between `r myround(min(GRF_accuracy$RMSE), 1)` N and `r myround(max(GRF_accuracy$RMSE), 1)` N. Although all pGRF prediction equations showed very similar results, the one based on hip-worn accelerometers and the resultant vector has shown the best performance, with an R^2^ of `r hip_GRF_accuracy$R2_cond`, the lowest MAE (`r myround(hip_GRF_accuracy$MAE, 1)` N), MAPE (`r myround(hip_GRF_accuracy$MAPE * 100, 1)`\%) and RMSE (`r myround(hip_GRF_accuracy$RMSE, 1)` N).

\medskip

Moreover, pLR prediction equations were also developed, and these included as predictors the pAR and again body mass. Regression coefficients, R^2^ and accuracy indices for these equations are also shown in Table 1. For these equations, the lowest R^2^ found was `r myround(min(LR_accuracy$R2_cond), 2)` and the highest was `r myround(max(LR_accuracy$R2_cond), 2)`, reflecting a moderate to high prediction ability. MAE, MAPE and RMSE values ranged from `r round(min(LR_accuracy$MAE), 0)` N to `r round(max(LR_accuracy$MAE), 0)` N, from `r myround(min(LR_accuracy$MAPE) * 100, 1)`\% to `r myround(max(LR_accuracy$MAPE) * 100, 1)`\%, and from `r round(min(LR_accuracy$RMSE), 0)` N to `r round(max(LR_accuracy$RMSE), 0)` N, respectively. These results show that the pLR prediction equations were all considerably poorer than those for the pGRF equations. The accuracy indices values were also somewhat worse than previously published pLR prediction equations [@Veras2020; @Fortune2014], although equations from both studies were only valid for walking activities. The pLR equation with the lowest prediction error was the one derived from accelerometers worn at hip and the resultant vector, with an R^2^ of `r hip_LR_accuracy$R2_cond` and a MAE, MAPE and RMSE of `r round(hip_LR_accuracy$MAE, 0)` N, `r myround(hip_LR_accuracy$MAPE * 100, 1)`\% and `r round(hip_LR_accuracy$RMSE, 0)` N, respectively.

\medskip

```{r accuracy_table, results = "show"}
source(here("tables", "tab1.R"))
tab1
```

Afterwards, Bland-Altman plots were built to visualize the agreement between the actual and predicted pGRF and pLR, for both the resultant vector and its vertical component from all accelerometer placements. Bland-Altman plots for the pGRF and pLR resultant vector from hip-worn accelerometers can be seen in Figure 3, and for all accelerometer placements and both resultant and vertical vectors in the Supplemental Figures S3 and S4. Values for all pGRF and pLR prediction equations developed tended to assemble around zero and between the limits of agreement, as shown by the fact that, for all models, at least `r ba_agreement`\% of the data points lie within the limits of agreement. For the pGRF equations, a tendency to higher dispersion can be observed for higher magnitudes, which correspond to the running trials, and especially in values derived from ankle-worn accelerometers (Supplemental Figure S3, Panels A and D). Prediction equations for pLR showed a more accentuated dispersion, and again mainly for higher magnitudes (Supplemental Figure S4). None of the models presented a bias different from zero (*p* > 0.05), demonstrating that they do not consistently over or underestimate the pGRF and pLR values. Although all equations showed a significant proportional bias (*p* < 0.05), the linear regressions presented a low R^2^, with the highest value being `r myround(max(ba_regression_ankle_R2), 2)`.

\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{fig3.png}
		\caption{Bland-Altman plots showing agreement between actual and predicted peak ground reaction force (Panel A) and loading rate (Panel B) for the resultant vector from hip-worn accelerometers. Continuous thick lines show bias (average of the differences between actual and predicted values) while dashed lines show the limits of agreement (bias \pm 1.96 standard deviation). Abbreviations: pGRF, peak ground reaction force; pLR, peak loading rate.}
	\end{measuredfigure}
\end{figure}

\medskip

Furthermore, we compared the performance of our equations with a reference equation previously published [@Neugebauer2014]. As the only comparable equation found was the one to predict pGRF vertical vector using hip-worn accelerometer data developed by Neugebauer et al [@Neugebauer2014], we applied it to our data and computed the MAE, MAPE and RMSE. Then, these indices were compared to the indices for our equation (Table 1). Apart from the overall equations performance, a sub-analysis was done separating walking and running trials. The results of these comparisons can be observed in Table 2. Accuracy indices of our equations were all better compared to the reference equation. Furthermore, our equation performance was constant between walking and running, indicating that it can be used for both activities without loss of accuracy, which cannot be observed in the reference equation.

```{r comparison_table, results = "show"}
source(here("tables", "tab2.R"))
tab2
```

Also, to simplify the use of these equations and enhance their applicability, a software package was developed for use in the R statistical software [@Veras2021a]. Included in this package are functionalities to read raw ACC data, process it and apply the equations to predict both pGRF and pLR. In the package website (https://verasls.github.io/impactr) there are also instructions on how to use it to obtain the predictions, namely in the 'Home' and 'Get started' sections.

# Discussion {.unnumbered}

The purpose of this study was to develop pGRF and pLR prediction equations based on accelerometer data able to accurately estimate mechanical loading during walking and running. Predictions were tested with accelerometers placed at different body locations, using both the resultant vector and its vertical component in a set of incremental speeds, ranging from slow walking to running. Our findings demonstrated that accelerometer-based regression models were a valid and accurate method to estimate pGRF during human locomotion, as all pGRF prediction models developed presented a MAPE below the 8\% threshold. However, accelerometry-based equations developed to predict pLR did not yield trustworthy results.

\medskip

Comparing our results with previous studies that used a similar approach to predict pGRF, prediction errors from our models are comparable with some studies whose best results presented a MAPE of approximately 6.0\%, but which included only walking in their protocol [@Fortune2014; @Neugebauer2018; @Veras2020]. Additionally, previous studies that developed pGRF prediction models during both walking and running showed a MAPE of 8.3\% [@Neugebauer2014], which is higher than our results, and 5.2\% [@Neugebauer2012] with no model cross-validation, which is similar to our results when no cross-validation method is applied (highest value of `r accuracy_no_cv`\% in our models). Nevertheless, models from both studies present a caveat, that is the inclusion of a term in their equations that distinguishes whether the activity is walking or running, which is not easy to be identified from free-living accelerometer data, hindering the real-world application of these previous equations. Also, one of these studies included in their sample only children and adolescents [@Neugebauer2012], which present a higher variability in their gait pattern compared to the adults [@Gouelle2016], making this equation unsuitable to use in an adult population. Furthermore, it was observed that the reference equation [@Neugebauer2014] used as reference has a much lower accuracy during walking compared with running (16.6\% vs. 9.7\%). As this reference equation was not validated in a sample including people with obesity, it performs poorly when applied to data from people with high body mass, as is the case in our sample that performed the walking trials, compared with running trials mostly performed by non-obese people. It is also important to mention that the prediction error found in our pGRF models is lower than the error typically found in models developed to estimate energy expenditure [@Diniz-Sousa2020], which is one of the main uses of accelerometer data [@Migueles2017].

\medskip

Our findings revealed that ankle, lower back or hip were all valid accelerometer placements to accurately predict pGRF. However, despite the similarities, hip was the accelerometer placement with the best prediction accuracy, which reinforces it as the preferable location to collect and analyze accelerometry-measured physical activity data. This placement is already well accepted for energy expenditure prediction and physical activity intensity classification [@Migueles2017] and has also shown a high mechanical loading prediction ability in previous studies [@Veras2020; @Neugebauer2018; @Neugebauer2012]. Besides various placements, the current study also analyzed predictions from both the resultant and vertical vectors. Although ACC and GRF from the vertical vector are the most studied and frequently associated with bone health [@Vainionpaa2006; @Heikkinen2007], the resultant vector of both ACC and GRF during locomotion is greatly determined by the vertical vector, and, as can be observed in Supplemental Figure S1, in this study values from both vectors were very similar. Also, mechanical loading prediction based on the resultant ACC offers the important advantage of not being dependent on the accelerometer positioning and correct orientation, which is hard to assure when measuring daily physical activity [@Welk2005; @Wundersitz2015].

\medskip

To the best of our knowledge, only two studies have already attempted to develop pLR prediction models based on accelerometry data, and both studies only included walking activities. Accordingly to what we found, these studies also showed that the prediction error for these models is considerably larger than for the pGRF prediction. One of these researches investigated the use of four different accelerometer placements (ankle, tibia, thigh and waist) to predict pLR and achieved a MAPE ranging from 23.4\% to 46.1\% [@Fortune2014], while the other obtained values from 19.5\% to 22.4\% using accelerometers at the lower back and hip [@Veras2020]. Results from the models developed in these previous investigations have both lower and higher prediction errors compared to our results, which were approximately of 35\%. Although pLR is an important variable, known for a long time to determine to a great extent the bone formation response to mechanical loading [@Bassey1998; @Turner1995], based on our findings and in previous studies [@Fortune2014; @Veras2020], its prediction through accelerometer data does not seem to yield trustworthy results.
\medskip

Results from our study offer some advantages compared to previous investigations: i) it includes walking and running, which are among the most usual types of physical activity performed daily; ii) all models developed, especially for pGRF prediction, presented a similar or better accuracy compared to the results from previous publications; iii) the accuracy of our models is fairly constant throughout walking and running, notably for the pGRF prediction models, with a MAPE increase from 6\% to 8\%, showing, therefore, that they can be used adequately for both activities; iv) in order to apply our models there is no need to manually distinguish the accelerometer data between walking and running, as in previously developed equations [@Neugebauer2014], which facilitates its use with daily living accelerometer data; and v) along with the creation of these models, a software was developed in the form of an R package to perform all the computations needed to get from the raw accelerometer data to the mechanical loading prediction.

\medskip

Besides these advantages, our models present some important potential clinical applications. For instance, these models can be used to analyze data from large observational studies and make associations between mechanical loading and bone health. But instead of analyzing accelerometer data averaged in epochs similarly to some previous publications [@Chastin2014; @Stiles2017], which can dilute the higher intensities [@Fabre2020], with our method raw ACC can be analyzed at a higher resolution by identifying the pGRF associated with each step taken and establishing, for example, the number of peaks above a certain magnitude threshold needed to elicit a positive bone adaptation. Another potential application could be the computation of the cumulative mechanical loading by adding up the pGRF of all detected steps [@Diniz-Sousa2021]. This information could be used either for the determination of the relationship between the mechanical loading accumulated in a certain period (e.g., a day) and the bone response to this loading [@Ahola2010], or to investigate the causes of bone loss in populations with bone health issues, such as bariatric patients [@Diniz-Sousa2021]. This approach has already been applied with equations developed in a previous research from our group [@Veras2020], but now can be extended to include both types of locomotion (walking and running) contemplated in the equations from the current study. Another possible application is in sports training, by monitoring the amount of loading beared by athletes and relate this information with osteoarticular safety of the training regimen [@Vanwanseele2020].

\medskip

Despite the validity of the prediction models developed here, some limitations should be mentioned. First, although the activities included in our protocol (walking and running) are among the most frequently performed motor activities during daily living, our prediction models do not apply to other activities known to influence bone adaptation to mechanical stimuli, such as jumping and direction changing. Second, in the absence of another sample for model validation, the leave-one-out cross-validation method was used, which is the method of choice in these situations [@Staudenmayer2012]. Nevertheless, future studies should test the out-of-sample validity of these models. Moreover, the protocol was performed on an instrumented treadmill. The use of a treadmill, although enhancing the study internal validity by the continuously measuring the GRF [@Ngoh2018] also reduces the external validity due to possible biomechanical changes in the walking and running patterns induced by the treadmill [@Kluitenberg2012]. Lastly, bone adaptation to mechanical stimulation depends not only on external loads, such as GRF, but also on internal loads generated by muscle forces [@Robling2009]. As accelerometers cannot reliably assess muscle force generation, they may have a limited capacity in estimating the bone response to loading in situations where there are no major gravitational loadings involved.

\medskip

In conclusion, pGRF could be accurately predicted by accelerometry-based regression models. These models are valid for the use of both the resultant vector and its vertical component, and using data from accelerometers placed at either the ankle, lower back or hip. The prediction models developed in this study have proved to be an efficient method to assess pGRF out of laboratory conditions, with potential applications for monitoring the mechanical loading in several contexts and establishing a relationship between mechanical loading and either beneficial or pathological osteoarticular adaptations. This is also the first work, to the best of our knowledge, to explore the prediction of pLR based on accelerometry data during both walking and running, although the accuracy of these models was unsatisfactory.

# Acknowledgments {.unnumbered}

This study was funded by the Fundação para a Ciência e a Tecnologia (FCT) (grant PTDC/DTP-DES/0968/2014) and by the European Regional Development Fund (ERDF) through the Operational Competitiveness Programme (COMPETE) (grant POCI-01-0145-FEDER-016707). The study was developed in the Research Centre in Physical Activity, Health and Leisure (CIAFEL) funded by ERDF through the COMPETE and by the FCT (grant UIDB/00617/2020), and Laboratory for Integrative and Translational Research in Population Health (ITR). Lucas Veras, Florêncio Diniz-Sousa and Giorjines Boppre were supported by the FCT grants UI/BD/150673/2020, SFRH/BD/117622/2016, SFRH/BD/146976/2019, respectively. The authors thank the participants who took part in this research and all who have collaborated in the project.

\newpage

# References {.unnumbered}

<div id="refs"></div>

\newpage

# Supplemental Material {.unnumbered}

## Supplemental Figure S1 {.unnumbered}
\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{figS1.png}
	\end{measuredfigure}
\end{figure}
\footnotesize Relationship between peak ground reaction force and acceleration magnitudes. Data from accelerometers worn at ankle (Panels A and D), lower back (Panels B and E) and hip (Panels C and F), for both the resultant vector (Panels A to C) and its vertical component (Panels D to F). Linear trends for each body mass index category are also depicted. Abbreviations: pACC, peak acceleration; pGRF, peak ground reaction force.

\medskip

## Supplemental Figure S2 {.unnumbered}
\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{figS2.png}
	\end{measuredfigure}
\end{figure}
\footnotesize Relationship between peak loading and acceleration rates. Data from accelerometers worn at ankle (Panels A and D), lower back (Panels B and E) and hip (Panels C and F), for both the resultant vector (Panels A to C) and its vertical component (Panels D to F). Linear trends for each body mass index category are also depicted. Abbreviations: pAR, peak acceleration rate; pLR, peak loading rate.

\newpage

## Supplemental Figure S3 {.unnumbered}
\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{figS3.png}
	\end{measuredfigure}
\end{figure}
\footnotesize Bland-Altman plots showing agreement between actual and predicted peak ground reaction force for accelerometers worn at ankle (Panels A and D), lower back (Panels B and E) and hip (Panels C and F), for both the resultant vector (Panels A to C) and its vertical component (Panels D to F). Continuous thick lines show bias (average of the differences between actual and predicted values) while dashed lines show the limits of agreement (bias \pm 1.96 standard deviation). Abbreviations: pGRF, peak ground reaction force.

## Supplemental Figure S4 {.unnumbered}
\begin{figure}[ht]
	\captionsetup{singlelinecheck = false, format = hang, justification = raggedright, font = footnotesize, labelsep = space}
	\centering
	\begin{measuredfigure}
		\includegraphics[width=\textwidth]{figS4.png}
	\end{measuredfigure}
\end{figure}
\footnotesize Bland-Altman plots showing agreement between actual and predicted peak loading rate for accelerometers worn at ankle (Panels A and D), lower back (Panels B and E) and hip (Panels C and F), for both the resultant vector (Panels A to C) and its vertical component (Panels D to F). Continuous thick lines show bias (average of the differences between actual and predicted values) while dashed lines show the limits of agreement (bias ± 1.96 standard deviation). Abbreviations: pLR, peak loading rate.
